<div class="card">
  <h1 class="text-2xl font-bold mb-4"><%= @post.title %></h1>
  <p class="mb-2"><%= simple_format(@post.body) %></p>
  <% if @post.tags.any? %>
    <p class="text-sm mb-2">
      <% @post.tags.each do |tag| %>
        <%= link_to "##{tag.name}", tag_path(tag.name), class: 'text-blue-600 hover:underline mr-2' %>
      <% end %>
    </p>
  <% end %>
  <% if @post.image_url.present? %>
    <img src="<%= @post.image_url %>" alt="post image" class="mb-4 max-w-full rounded">
  <% end %>
  <p class="text-sm text-gray-500 mb-4">Posted by <%= @post.user.username %></p>
  <div class="mb-4">
    <% if current_user == @post.user %>
      <%= link_to 'Edit', edit_post_path(@post), class: 'text-blue-600 hover:underline mr-2', data: { turbo: false } %>
    <% end %>
    <%= link_to 'Back', posts_path, class: 'text-blue-600 hover:underline' %>
  </div>
  <div class="mb-2">
    <span class="mr-2"><%= pluralize(@post.likes.count, 'like') %></span>
    <% if user_signed_in? %>
      <% if @post.likes.exists?(user: current_user) %>
        <%= button_to 'Unlike', post_like_path(@post), method: :delete, class: 'text-red-600 hover:underline' %>
      <% else %>
        <%= button_to 'Like', post_like_path(@post), class: 'text-blue-600 hover:underline' %>
      <% end %>
    <% end %>
  </div>
</div>

<div class="card mt-6">
  <h2 class="text-xl font-semibold mb-2">Comments</h2>
  <div class="space-y-2 mb-4">
    <%= render @post.comments %>
  </div>
  <% if current_user %>
    <%= form_with(model: [@post, Comment.new], class: 'space-y-2') do |form| %>
      <%= form.text_area :body, class: 'border rounded w-full p-2', rows: 3 %>
      <%= form.submit 'Add Comment', class: 'bg-blue-600 text-white px-3 py-1 rounded' %>
    <% end %>
  <% end %>
</div>
